{% extends base_generic %}
{% load static %}

{% block content %}
  <a href="{% url 'rsshistory:searchinitview' %}" class='simplebutton'>
      <img src="{% static 'rsshistory/icons/icons8-start-100.png' %}" height="{{icon_size}}" />
      Reset filters</a>

  <form action="{{filter_form.action_url}}" method="{{filter_form.method}}">
     {{ filter_form }}
     <input type="submit" value="Submit">
  </form>

  {% if search_term %}
     <a href="https://en.wikipedia.org/w/index.php?search={{search_term}}" class="simplebutton">Ask wikipedia</a>
     <a href="https://www.quora.com/search?q={{search_term}}" class="simplebutton">Ask Quora</a>
     <a href="https://stackoverflow.com/search?q={{search_term}}" class="simplebutton">Ask Stack Overflow</a>
     <a href="https://www.wolframalpha.com/input?i={{search_term}}" class="simplebutton">Ask wolfram alpha</a>
  {% endif %}

  <hr>
    {% if rss_are_fetched %}
       <div style="color:red">Sources are fetched. Queue size: {{rss_queue_size}} </div>
       <hr>
    {% endif %}

  {% if entries_list %}
  <ul class="linklist">
    {% for link in entries_list %}
      <li>
          {% if user_config.display_type == "std" or user_config.display_type == "" %}
              <a href="{{ link.get_absolute_url }}"
                 {% if link.persistent %}
                    class="longbutton longbuttonselected"
                 {% else %}
                    class="longbutton"
                 {% endif %}
                >

                  {% if user_config.show_icons %}
                    <img src=
                      {% if user_config.thumbnails_as_icons %}
                          "{{link.get_thumbnail}}"
                      {% else %}
                          "{{link.get_favicon}}"
                      {% endif %}

                      {% if user_config.small_icons %}
                         width="{{icon_size}}"/>
                      {% else %}
                         class="linklistthumbnail"/>
                      {% endif %}
                  {% endif %}

                <div class="linklistitem">
                    <div class="linklistitemtitle">
                      {% if link.dead %}
                         Hidden link
                      {% else %}
                         {{link.title}} {{link.date_published}}  {{link.get_source_name}}
                      {% endif %}

                       {% if link.get_tag_string %}
                       Tags: 
                           {% for tag in link.get_tag_map %}
                               #{{tag}},
                           {% endfor %}
                       {% endif %}
                       {% if link.persistent %}
                          User: {{link.user}}
                       {% endif %}
                    </div>
                    <div class="linklistitemdescription">
                    </div>
                </div>
              </a>
          {% elif user_config.display_type == "clickable-tags" %}
             <span
                {% if link.persistent %}
                   class="longbutton longbuttonselected"
                {% else %}
                   class="longbutton"
                {% endif %}
                     >

               <div class="linklistitem">
                   <a href="{{ link.get_absolute_url }}" class="linklistitemtitle">
                      {% if user_config.show_icons %}
                      <img src="{{link.get_favicon}}" width="{{icon_size}}"/>
                      {% endif %}

                      {% if link.dead %}
                         Hidden link
                      {% else %}
                         {{link.title}} {{link.date_published}}  {{link.get_source_name}}
                      {% endif %}
                   </a>
                  <div class="linklistitemdescription">
                      {% if link.get_tag_string %}
                      Tags: 
                          {% for tag in link.get_tag_map %}
                              <a href="{% url 'rsshistory:entries'%}?tag={{tag}}" class="simplebutton">{{tag}}</a>
                          {% endfor %}
                      {% endif %}
                      {% if link.persistent %}
                         User: {{link.user}}
                      {% endif %}

                  </div>
               </div>
             </span>
          {% elif user_config.display_type == "line-and-buttons" %}
              <a href="{{ link.link }}"
                 {% if link.persistent %}
                    class="longbutton longbuttonselected"
                 {% else %}
                    class="longbutton"
                 {% endif %}
                      >

                <div class="linklistitem">
                   <img src="{{link.get_favicon}}" width="20"/>
                   {% if link.dead %}
                      <span class="linklistitemtitle">Hidden link</span>
                   {% else %}
                      <span class="linklistitemtitle">{{link.title}}</span> {{link.date_published}}  {{link.get_source_name}}
                   {% endif %}

                   {% if link.get_tag_string %}
                       , Tags: # {{ link.get_tag_string }}
                   {% endif %}
                   {% if link.user %}
                      , User: {{link.user}}
                   {% endif %}

                </div>
              </a>

              {% if user.is_staff %}
              <a href="{{ link.get_absolute_url }}" class="simplebutton">
                 Details
              </a>
                 {% if link.persistent %}
                  <a href="{% url 'rsshistory:entry-notstar' link.id %}" class="simplebutton">
                   Not bookmarked
                  </a>
                  <a href="{% url 'rsshistory:entry-tag' link.id %}" class="simplebutton">Tag entry</a>
                 {% else %}
                  <a href="{% url 'rsshistory:entry-star' link.id %}" class="simplebutton">
                   Bookmark
                  </a>
                 {% endif %}
                 <!--a href="{% url 'rsshistory:entry-remove' link.id %}" class="simplebutton">Remove entry</a-->
              {% else %}
              <hr>
              {% endif %}
          {% endif %}
      </li>
    {% endfor %}
  </ul>

<div class="pagination">
    <span class="step-links">
        {% if page_obj.has_previous %}
           <a href="?page=1{{filter_form.get_filter_string}}" class='simplebutton'>&laquo; first</a>
           <a href="?page={{ page_obj.previous_page_number }}{{filter_form.get_filter_string}}" class='simplebutton'>previous</a>
        {% endif %}

        <span class="current">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
        </span>

        {% if page_obj.has_next %}
          <a href="?page={{ page_obj.next_page_number }}{{filter_form.get_filter_string}}" class='simplebutton'>next</a>
          <a href="?page={{ page_obj.paginator.num_pages }}{{filter_form.get_filter_string}}" class='simplebutton'>last &raquo;</a>
        {% endif %}

        <span>Records: {{entries_list | length}} </span>
    </span>
</div>

  {% else %}
    <p>There are no links.</p>
  {% endif %}
{% endblock %}
